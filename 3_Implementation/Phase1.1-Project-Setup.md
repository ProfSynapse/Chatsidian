---
title: Phase 1.1 - Project Setup and Development Environment
description: Setting up the basic project structure and development environment for the Chatsidian plugin
date: 2025-05-03
status: planning
tags:
  - implementation
  - project-setup
  - development-environment
  - chatsidian
---

# Phase 1.1: Project Setup and Development Environment

## Overview

This microphase focuses on setting up the foundational project structure and development environment for the Chatsidian plugin. A well-configured environment is crucial for efficient development, testing, and deployment of the plugin.

## Objectives

- Initialize the project repository with necessary configuration files
- Set up the build system using esbuild for efficient compilation
- Configure TypeScript for type safety and developer experience
- Create the basic plugin boilerplate following Obsidian's requirements
- Set up testing environment using Jest
- Prepare project documentation

## Implementation Steps

### 1. Initialize Project Repository

```bash
# Create project directory
mkdir chatsidian
cd chatsidian

# Initialize npm project
npm init -y

# Initialize git repository
git init
touch .gitignore
```

Add to `.gitignore`:
```
node_modules/
.DS_Store
*.log
dist/
main.js
data.json
coverage/
.idea/
.vscode/
```

### 2. Configure Build System with esbuild

Install required dependencies:
```bash
npm install --save-dev esbuild builtin-modules
```

Create `esbuild.config.mjs` file:
```javascript
import esbuild from "esbuild";
import process from "process";
import builtins from "builtin-modules";

const banner = `/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
*/
`;

const prod = process.argv[2] === "production";

const context = await esbuild.context({
  banner: {
    js: banner,
  },
  entryPoints: ["src/main.ts"],
  bundle: true,
  external: [
    "obsidian",
    "electron",
    "@codemirror/state",
    "@codemirror/view",
    ...builtins
  ],
  format: "cjs",
  target: "es2018",
  logLevel: "info",
  sourcemap: prod ? false : "inline",
  treeShaking: true,
  outfile: "main.js",
});

if (prod) {
  await context.rebuild();
  process.exit(0);
} else {
  await context.watch();
}
```

### 3. Set up TypeScript Configuration

Install TypeScript:
```bash
npm install --save-dev typescript @types/node
```

Create `tsconfig.json`:
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "inlineSourceMap": true,
    "inlineSources": true,
    "module": "ESNext",
    "target": "ES2018",
    "allowJs": true,
    "noImplicitAny": true,
    "moduleResolution": "node",
    "importHelpers": true,
    "isolatedModules": true,
    "strictNullChecks": true,
    "lib": [
      "DOM",
      "ES5",
      "ES6",
      "ES7",
      "ES2021"
    ],
    "jsx": "preserve"
  },
  "include": [
    "**/*.ts"
  ]
}
```

### 4. Create Basic Plugin Boilerplate

Create basic directory structure:
```bash
mkdir -p src/models src/core src/providers
```

Create `manifest.json` file:
```json
{
  "id": "chatsidian",
  "name": "Chatsidian",
  "version": "0.1.0",
  "minAppVersion": "1.4.0",
  "description": "An Obsidian plugin for native chat with MCP integration",
  "author": "Your Name",
  "authorUrl": "https://github.com/yourusername",
  "fundingUrl": "",
  "isDesktopOnly": false
}
```

Create initial `src/main.ts` file:
```typescript
import { Plugin } from 'obsidian';
import { ChatsidianSettings, DEFAULT_SETTINGS } from './models/Settings';

export default class ChatsidianPlugin extends Plugin {
  settings: ChatsidianSettings;

  async onload() {
    console.log('Loading Chatsidian plugin');
    
    // Load settings
    await this.loadSettings();
    
    // Add command to open chat
    this.addCommand({
      id: 'open-chatsidian',
      name: 'Open Chatsidian',
      callback: () => {
        console.log('Chat interface not yet implemented');
      }
    });
    
    // Add ribbon icon
    this.addRibbonIcon('message-square', 'Chatsidian', () => {
      console.log('Chatsidian ribbon icon clicked');
      // Will later open the chat interface
    });
    
    console.log('Chatsidian plugin loaded');
  }
  
  async onunload() {
    console.log('Unloading Chatsidian plugin');
  }
  
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  
  async saveSettings() {
    await this.saveData(this.settings);
  }
}
```

### 5. Configure Testing Environment with Jest

Install Jest and related dependencies:
```bash
npm install --save-dev jest @types/jest ts-jest
```

Create `jest.config.js`:
```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  moduleFileExtensions: ['ts', 'js'],
  testMatch: ['**/__tests__/**/*.ts', '**/?(*.)+(spec|test).ts'],
  transform: {
    '^.+\\.ts$': 'ts-jest',
  },
  moduleNameMapper: {
    '^src/(.*)$': '<rootDir>/src/$1',
  },
  collectCoverage: true,
  coverageDirectory: 'coverage',
};
```

Add test script to `package.json`:
```json
"scripts": {
  "dev": "node esbuild.config.mjs",
  "build": "tsc -noEmit -skipLibCheck && node esbuild.config.mjs production",
  "test": "jest",
  "coverage": "jest --coverage"
}
```

Create a simple test to verify setup:
```bash
mkdir -p tests
touch tests/setup.test.ts
```

Add to `tests/setup.test.ts`:
```typescript
describe('Testing setup', () => {
  test('Jest is working', () => {
    expect(1 + 1).toBe(2);
  });
});
```

### 6. Create Project Documentation Structure

Create basic documentation files:
```bash
touch README.md CHANGELOG.md CONTRIBUTING.md
```

Add basic content to `README.md`:
```markdown
# Chatsidian

An Obsidian plugin for native chat with MCP integration.

## Features

- Connect to AI services via API
- Store conversations in your vault
- Leverage Model Context Protocol for enhanced capabilities
- Extend functionality with Bounded Context Packs

## Installation

1. Download the latest release
2. Extract the zip file into your Obsidian plugins folder
3. Enable the plugin in Obsidian settings

## Development

### Prerequisites

- Node.js 16+
- npm or yarn

### Setup

```bash
# Clone the repository
git clone https://github.com/yourusername/chatsidian.git
cd chatsidian

# Install dependencies
npm install

# Build the plugin
npm run build

# Run in development mode with auto-reload
npm run dev
```

## Testing

```bash
# Run tests
npm test

# Generate coverage report
npm run coverage
```

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for details on how to contribute to this project.

## License

MIT
```

## Configuration Tips

### Local Development in Obsidian

For local development with Obsidian:

1. Create a symbolic link from your build output to an Obsidian vault's plugins directory:
   ```bash
   # On macOS/Linux
   ln -s /path/to/chatsidian /path/to/obsidian/vault/.obsidian/plugins/chatsidian
   
   # On Windows (as administrator)
   mklink /D "C:\path\to\obsidian\vault\.obsidian\plugins\chatsidian" "C:\path\to\chatsidian"
   ```

2. Run in dev mode with auto-reload:
   ```bash
   npm run dev
   ```

3. Enable the plugin in Obsidian's Community Plugins settings

## References

- [[ðŸ’» Coding/Documentation/Obsidian/Plugin - Documentation.md]] - Obsidian Plugin API documentation
- [[ðŸ’» Coding/Documentation/Obsidian/PluginSettingTab - Documentation.md]] - Plugin settings documentation

## Next Steps

After completing this microphase, proceed to:
- [[ðŸ’» Coding/Projects/Chatsidian/3_Implementation/Phase1.2-Data-Models.md]] - Implementing data models and interfaces

### 7. Additional Recommendations for Leveraging Obsidian APIs

#### Using Obsidian's Built-in Settings Management

Instead of creating a completely custom settings system in the upcoming phases, consider using Obsidian's built-in methods for settings management:

```typescript
// In main.ts
async loadSettings() {
  this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
}

async saveSettings() {
  await this.saveData(this.settings);
}
```

This leverages Obsidian's existing settings storage rather than creating a custom implementation.

#### Simplified Settings Tab Implementation

When creating the settings tab in Phase 1.4, consider this simplified structure that leverages Obsidian's API:

```typescript
import { App, PluginSettingTab, Setting } from 'obsidian';
import { ChatsidianPlugin } from './main';

export class ChatsidianSettingTab extends PluginSettingTab {
  plugin: ChatsidianPlugin;

  constructor(app: App, plugin: ChatsidianPlugin) {
    super(app, plugin);
    this.plugin = plugin;
  }

  display(): void {
    const { containerEl } = this;
    containerEl.empty();

    // Add your settings UI here
    new Setting(containerEl)
      .setName('API Key')
      .setDesc('Your API key for the AI service')
      .addText(text => text
        .setPlaceholder('Enter API key')
        .setValue(this.plugin.settings.apiKey)
        .onChange(async (value) => {
          this.plugin.settings.apiKey = value;
          await this.plugin.saveSettings();
        }));
  }
}
```

#### Utilizing Obsidian's Vault API for File Operations

For the upcoming Storage Abstractions phase, leverage Obsidian's Vault API directly instead of creating additional abstraction layers:

```typescript
// Reading a file
const file = this.app.vault.getAbstractFileByPath(path);
const content = await this.app.vault.read(file);

// Creating a file
await this.app.vault.create(path, content);

// Modifying a file
await this.app.vault.modify(file, newContent);

// Creating a folder
await this.app.vault.createFolder(folderPath);
```

#### Testing with Obsidian Mocks

For testing, consider using mock objects that replicate Obsidian's API structure:

```typescript
import { mock } from 'jest-mock-extended';
import { App, Vault, TFile } from 'obsidian';

describe('ChatsidianPlugin', () => {
  let mockApp: jest.Mocked<App>;
  let mockVault: jest.Mocked<Vault>;
  
  beforeEach(() => {
    mockVault = mock<Vault>();
    mockApp = mock<App>({
      vault: mockVault
    });
  });
  
  test('Plugin loads correctly', () => {
    // Test implementation
  });
});
```

This approach with `jest-mock-extended` provides better type safety and more accurately represents Obsidian's API structure.
