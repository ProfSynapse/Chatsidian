/**
 * Settings model for the Chatsidian plugin.
 * Defines the structure for user-configurable settings,
 * provides default values, and includes utilities for validation
 * and integration with Obsidian's data persistence.
 */
/**
 * Default values for all Chatsidian settings.
 * Used when initializing settings for the first time or when a setting is missing.
 */
export const DEFAULT_SETTINGS = {
    provider: 'anthropic',
    apiKey: '',
    apiEndpoint: '', // Default to empty string
    model: 'claude-3-opus-20240229', // Default to a known powerful model
    conversationsFolder: '.chatsidian/conversations', // Store in a hidden folder by default
    maxMessages: 100, // Reasonable default for memory management
    defaultSystemPrompt: 'You are an AI assistant integrated into Obsidian. Use your tools to help the user manage their vault and notes.',
    theme: 'system', // Follow Obsidian's theme by default
    fontSize: 14, // Common default font size
    showTimestamps: true,
    debugMode: false,
    autoLoadBCPs: ['NoteManager', 'FolderManager', 'VaultLibrarian'], // Sensible defaults
    defaultTemperature: 0.7, // Balanced default
    defaultMaxTokens: 4000, // Allow reasonably long responses
};
/**
 * Provides utility functions for validating and handling Chatsidian settings.
 */
export class SettingsUtils {
    /**
     * Validates a partial settings object and merges it with defaults.
     * Ensures that all settings have valid values.
     * @param settings The potentially partial or invalid settings object.
     * @returns A complete and valid ChatsidianSettings object.
     */
    static validate(settings) {
        const merged = { ...DEFAULT_SETTINGS, ...settings };
        return {
            ...merged,
            provider: this.validateProvider(merged.provider),
            apiKey: merged.apiKey || '', // Ensure apiKey is at least an empty string
            apiEndpoint: merged.apiEndpoint || '', // Ensure apiEndpoint is at least an empty string
            conversationsFolder: this.validateFolderPath(merged.conversationsFolder),
            maxMessages: Math.max(10, merged.maxMessages || DEFAULT_SETTINGS.maxMessages), // Ensure at least 10
            defaultSystemPrompt: merged.defaultSystemPrompt !== undefined ? merged.defaultSystemPrompt : DEFAULT_SETTINGS.defaultSystemPrompt,
            theme: this.validateTheme(merged.theme),
            fontSize: Math.max(8, merged.fontSize || DEFAULT_SETTINGS.fontSize), // Ensure at least 8px
            showTimestamps: typeof merged.showTimestamps === 'boolean' ? merged.showTimestamps : DEFAULT_SETTINGS.showTimestamps,
            debugMode: typeof merged.debugMode === 'boolean' ? merged.debugMode : DEFAULT_SETTINGS.debugMode,
            autoLoadBCPs: Array.isArray(merged.autoLoadBCPs) ? merged.autoLoadBCPs : DEFAULT_SETTINGS.autoLoadBCPs,
            defaultTemperature: this.validateTemperature(merged.defaultTemperature),
            defaultMaxTokens: this.validateMaxTokens(merged.defaultMaxTokens),
        };
    }
    /**
     * Validates the provider setting, defaulting if invalid.
     */
    static validateProvider(provider) {
        const validProviders = [
            'anthropic',
            'openai',
            'openrouter',
            'google',
            'custom',
        ];
        return validProviders.includes(provider)
            ? provider
            : DEFAULT_SETTINGS.provider;
    }
    /**
     * Validates the theme setting, defaulting if invalid.
     */
    static validateTheme(theme) {
        const validThemes = ['light', 'dark', 'system'];
        return validThemes.includes(theme)
            ? theme
            : DEFAULT_SETTINGS.theme;
    }
    /**
     * Validates and normalizes a folder path string.
     * Removes leading/trailing slashes and ensures it's not empty.
     */
    static validateFolderPath(path) {
        if (!path)
            return DEFAULT_SETTINGS.conversationsFolder;
        // Remove leading/trailing slashes and backslashes
        path = path.replace(/^[\\/]+|[\\/]+$/g, '');
        // Ensure path is not empty after trimming
        return path || DEFAULT_SETTINGS.conversationsFolder;
    }
    /**
     * Validates the temperature setting, clamping it between 0 and 1.
     */
    static validateTemperature(temperature) {
        const temp = temperature !== null && temperature !== void 0 ? temperature : DEFAULT_SETTINGS.defaultTemperature;
        return Math.max(0, Math.min(1, temp));
    }
    /**
     * Validates the max tokens setting, ensuring it's a positive integer within a reasonable range.
     */
    static validateMaxTokens(maxTokens) {
        const tokens = maxTokens !== null && maxTokens !== void 0 ? maxTokens : DEFAULT_SETTINGS.defaultMaxTokens;
        // Assuming a practical upper limit, e.g., 32k, adjust as needed
        return Math.max(1, Math.min(32000, Math.floor(tokens)));
    }
}
/**
 * Loads settings from Obsidian's data persistence, validates them, and returns a complete settings object.
 * @param loadedData Data object loaded via Obsidian's `loadData()`.
 * @returns A validated ChatsidianSettings object.
 */
export function loadSettings(loadedData) {
    // The loadedData might be null or undefined if it's the first time
    return SettingsUtils.validate(loadedData || {});
}
/**
 * Prepares the settings object for saving via Obsidian's `saveData()`.
 * Currently, it's an identity function but can be used for transformations if needed later.
 * @param settings The settings object to prepare for saving.
 * @returns The settings object ready to be saved.
 */
export function prepareSettingsForSave(settings) {
    // Example transformation (if needed): Convert Date objects to timestamps
    // For now, just return the settings as is, assuming they are JSON-serializable
    return { ...settings };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2V0dGluZ3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTZXR0aW5ncy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7R0FLRztBQXlESDs7O0dBR0c7QUFDSCxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBdUI7SUFDbEQsUUFBUSxFQUFFLFdBQVc7SUFDckIsTUFBTSxFQUFFLEVBQUU7SUFDVixXQUFXLEVBQUUsRUFBRSxFQUFFLDBCQUEwQjtJQUMzQyxLQUFLLEVBQUUsd0JBQXdCLEVBQUUsb0NBQW9DO0lBQ3JFLG1CQUFtQixFQUFFLDJCQUEyQixFQUFFLHNDQUFzQztJQUN4RixXQUFXLEVBQUUsR0FBRyxFQUFFLDJDQUEyQztJQUM3RCxtQkFBbUIsRUFDakIsaUhBQWlIO0lBQ25ILEtBQUssRUFBRSxRQUFRLEVBQUUscUNBQXFDO0lBQ3RELFFBQVEsRUFBRSxFQUFFLEVBQUUsMkJBQTJCO0lBQ3pDLGNBQWMsRUFBRSxJQUFJO0lBQ3BCLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLFlBQVksRUFBRSxDQUFDLGFBQWEsRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLENBQUMsRUFBRSxvQkFBb0I7SUFDdEYsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLG1CQUFtQjtJQUM1QyxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsa0NBQWtDO0NBQzNELENBQUM7QUFFRjs7R0FFRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBQ3hCOzs7OztPQUtHO0lBQ0gsTUFBTSxDQUFDLFFBQVEsQ0FBQyxRQUFxQztRQUNuRCxNQUFNLE1BQU0sR0FBRyxFQUFFLEdBQUcsZ0JBQWdCLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQztRQUVwRCxPQUFPO1lBQ0wsR0FBRyxNQUFNO1lBQ1QsUUFBUSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO1lBQ2hELE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsRUFBRSw0Q0FBNEM7WUFDekUs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QyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQ7O09BRUc7SUFDSyxNQUFNLENBQUMsaUJBQWlCLENBQUMsU0FBa0I7UUFDakQsTUFBTSxNQUFNLEdBQUcsU0FBUyxhQUFULFNBQVMsY0FBVCxTQUFTLEdBQUksZ0JBQWdCLENBQUMsZ0JBQWdCLENBQUM7UUFDOUQsZ0VBQWdFO1FBQ2hFLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUQsQ0FBQztDQUNGO0FBRUQ7Ozs7R0FJRztBQUNILE1BQU0sVUFBVSxZQUFZLENBQUMsVUFBZTtJQUMxQyxtRUFBbUU7SUFDbkUsT0FBTyxhQUFhLENBQUMsUUFBUSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUNsRCxDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsc0JBQXNCLENBQUMsUUFBNEI7SUFDakUseUVBQXlFO0lBQ3pFLCtFQUErRTtJQUMvRSxPQUFPLEVBQUUsR0FBRyxRQUFRLEVBQUUsQ0FBQztBQUN6QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFNldHRpbmdzIG1vZGVsIGZvciB0aGUgQ2hhdHNpZGlhbiBwbHVnaW4uXHJcbiAqIERlZmluZXMgdGhlIHN0cnVjdHVyZSBmb3IgdXNlci1jb25maWd1cmFibGUgc2V0dGluZ3MsXHJcbiAqIHByb3ZpZGVzIGRlZmF1bHQgdmFsdWVzLCBhbmQgaW5jbHVkZXMgdXRpbGl0aWVzIGZvciB2YWxpZGF0aW9uXHJcbiAqIGFuZCBpbnRlZ3JhdGlvbiB3aXRoIE9ic2lkaWFuJ3MgZGF0YSBwZXJzaXN0ZW5jZS5cclxuICovXHJcblxyXG4vKipcclxuICogSW50ZXJmYWNlIGRlZmluaW5nIHRoZSBzdHJ1Y3R1cmUgb2YgQ2hhdHNpZGlhbiBwbHVnaW4gc2V0dGluZ3MuXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIENoYXRzaWRpYW5TZXR0aW5ncyB7XHJcbiAgLy8gLS0tIEFQSSBDb25maWd1cmF0aW9uIC0tLVxyXG5cclxuICAvKiogVGhlIEFJIHByb3ZpZGVyIHNlcnZpY2UgdG8gdXNlIChlLmcuLCAnYW50aHJvcGljJywgJ29wZW5haScpICovXHJcbiAgcHJvdmlkZXI6ICdhbnRocm9waWMnIHwgJ29wZW5haScgfCAnb3BlbnJvdXRlcicgfCAnZ29vZ2xlJyB8ICdjdXN0b20nO1xyXG5cclxuICAvKiogQVBJIGtleSBmb3IgdGhlIHNlbGVjdGVkIHByb3ZpZGVyICovXHJcbiAgYXBpS2V5OiBzdHJpbmc7XHJcblxyXG4gIC8qKiBPcHRpb25hbCBjdXN0b20gQVBJIGVuZHBvaW50IFVSTCAoZm9yIGN1c3RvbSBwcm92aWRlcnMgb3IgcHJveGllcykgKi9cclxuICBhcGlFbmRwb2ludD86IHN0cmluZztcclxuXHJcbiAgLyoqIFRoZSBzcGVjaWZpYyBtb2RlbCBpZGVudGlmaWVyIHRvIHVzZSB3aXRoIHRoZSBzZWxlY3RlZCBwcm92aWRlciAqL1xyXG4gIG1vZGVsOiBzdHJpbmc7XHJcblxyXG4gIC8vIC0tLSBDb252ZXJzYXRpb24gU2V0dGluZ3MgLS0tXHJcblxyXG4gIC8qKiBWYXVsdCBmb2xkZXIgcGF0aCB3aGVyZSBjb252ZXJzYXRpb24gZmlsZXMgYXJlIHN0b3JlZCAqL1xyXG4gIGNvbnZlcnNhdGlvbnNGb2xkZXI6IHN0cmluZztcclxuXHJcbiAgLyoqIE1heGltdW0gbnVtYmVyIG9mIG1lc3NhZ2VzIHRvIGtlZXAgbG9hZGVkIGluIG1lbW9yeSBwZXIgY29udmVyc2F0aW9uICovXHJcbiAgbWF4TWVzc2FnZXM6IG51bWJlcjsgLy8gQ29uc2lkZXIgaWYgdGhpcyBpcyBzdGlsbCBuZWVkZWQgb3IgaGFuZGxlZCBieSBzdG9yYWdlL3ZpZXdcclxuXHJcbiAgLyoqIERlZmF1bHQgc3lzdGVtIHByb21wdCB1c2VkIGZvciBuZXcgY29udmVyc2F0aW9ucyAqL1xyXG4gIGRlZmF1bHRTeXN0ZW1Qcm9tcHQ6IHN0cmluZztcclxuXHJcbiAgLy8gLS0tIFVJIFNldHRpbmdzIC0tLVxyXG5cclxuICAvKiogVUkgdGhlbWUgcHJlZmVyZW5jZSAqL1xyXG4gIHRoZW1lOiAnbGlnaHQnIHwgJ2RhcmsnIHwgJ3N5c3RlbSc7IC8vICdzeXN0ZW0nIGZvbGxvd3MgT2JzaWRpYW4ncyB0aGVtZVxyXG5cclxuICAvKiogRm9udCBzaXplIGZvciB0aGUgY2hhdCBpbnRlcmZhY2UgKi9cclxuICBmb250U2l6ZTogbnVtYmVyO1xyXG5cclxuICAvKiogV2hldGhlciB0byBkaXNwbGF5IHRpbWVzdGFtcHMgbmV4dCB0byBtZXNzYWdlcyAqL1xyXG4gIHNob3dUaW1lc3RhbXBzOiBib29sZWFuO1xyXG5cclxuICAvLyAtLS0gQWR2YW5jZWQgU2V0dGluZ3MgLS0tXHJcblxyXG4gIC8qKiBFbmFibGUgdmVyYm9zZSBsb2dnaW5nIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMgKi9cclxuICBkZWJ1Z01vZGU6IGJvb2xlYW47XHJcblxyXG4gIC8qKiBMaXN0IG9mIEJvdW5kZWQgQ29udGV4dCBQYWNrIChCQ1ApIG5hbWVzIHRvIGxvYWQgYXV0b21hdGljYWxseSBvbiBzdGFydHVwICovXHJcbiAgYXV0b0xvYWRCQ1BzOiBzdHJpbmdbXTtcclxuXHJcbiAgLyoqIERlZmF1bHQgdGVtcGVyYXR1cmUgcGFyYW1ldGVyIGZvciBBSSByZXF1ZXN0cyAoY29udHJvbHMgcmFuZG9tbmVzcykgKi9cclxuICBkZWZhdWx0VGVtcGVyYXR1cmU6IG51bWJlcjtcclxuXHJcbiAgLyoqIERlZmF1bHQgbWF4aW11bSB0b2tlbnMgcGFyYW1ldGVyIGZvciBBSSByZXNwb25zZXMgKGxpbWl0cyByZXNwb25zZSBsZW5ndGgpICovXHJcbiAgZGVmYXVsdE1heFRva2VuczogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogRGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCBDaGF0c2lkaWFuIHNldHRpbmdzLlxyXG4gKiBVc2VkIHdoZW4gaW5pdGlhbGl6aW5nIHNldHRpbmdzIGZvciB0aGUgZmlyc3QgdGltZSBvciB3aGVuIGEgc2V0dGluZyBpcyBtaXNzaW5nLlxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IENoYXRzaWRpYW5TZXR0aW5ncyA9IHtcclxuICBwcm92aWRlcjogJ2FudGhyb3BpYycsXHJcbiAgYXBpS2V5OiAnJyxcclxuICBhcGlFbmRwb2ludDogJycsIC8vIERlZmF1bHQgdG8gZW1wdHkgc3RyaW5nXHJcbiAgbW9kZWw6ICdjbGF1ZGUtMy1vcHVzLTIwMjQwMjI5JywgLy8gRGVmYXVsdCB0byBhIGtub3duIHBvd2VyZnVsIG1vZGVsXHJcbiAgY29udmVyc2F0aW9uc0ZvbGRlcjogJy5jaGF0c2lkaWFuL2NvbnZlcnNhdGlvbnMnLCAvLyBTdG9yZSBpbiBhIGhpZGRlbiBmb2xkZXIgYnkgZGVmYXVsdFxyXG4gIG1heE1lc3NhZ2VzOiAxMDAsIC8vIFJlYXNvbmFibGUgZGVmYXVsdCBmb3IgbWVtb3J5IG1hbmFnZW1lbnRcclxuICBkZWZhdWx0U3lzdGVtUHJvbXB0OlxyXG4gICAgJ1lvdSBhcmUgYW4gQUkgYXNzaXN0YW50IGludGVncmF0ZWQgaW50byBPYnNpZGlhbi4gVXNlIHlvdXIgdG9vbHMgdG8gaGVscCB0aGUgdXNlciBtYW5hZ2UgdGhlaXIgdmF1bHQgYW5kIG5vdGVzLicsXHJcbiAgdGhlbWU6ICdzeXN0ZW0nLCAvLyBGb2xsb3cgT2JzaWRpYW4ncyB0aGVtZSBieSBkZWZhdWx0XHJcbiAgZm9udFNpemU6IDE0LCAvLyBDb21tb24gZGVmYXVsdCBmb250IHNpemVcclxuICBzaG93VGltZXN0YW1wczogdHJ1ZSxcclxuICBkZWJ1Z01vZGU6IGZhbHNlLFxyXG4gIGF1dG9Mb2FkQkNQczogWydOb3RlTWFuYWdlcicsICdGb2xkZXJNYW5hZ2VyJywgJ1ZhdWx0TGlicmFyaWFuJ10sIC8vIFNlbnNpYmxlIGRlZmF1bHRzXHJcbiAgZGVmYXVsdFRlbXBlcmF0dXJlOiAwLjcsIC8vIEJhbGFuY2VkIGRlZmF1bHRcclxuICBkZWZhdWx0TWF4VG9rZW5zOiA0MDAwLCAvLyBBbGxvdyByZWFzb25hYmx5IGxvbmcgcmVzcG9uc2VzXHJcbn07XHJcblxyXG4vKipcclxuICogUHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIHZhbGlkYXRpbmcgYW5kIGhhbmRsaW5nIENoYXRzaWRpYW4gc2V0dGluZ3MuXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2V0dGluZ3NVdGlscyB7XHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGVzIGEgcGFydGlhbCBzZXR0aW5ncyBvYmplY3QgYW5kIG1lcmdlcyBpdCB3aXRoIGRlZmF1bHRzLlxyXG4gICAqIEVuc3VyZXMgdGhhdCBhbGwgc2V0dGluZ3MgaGF2ZSB2YWxpZCB2YWx1ZXMuXHJcbiAgICogQHBhcmFtIHNldHRpbmdzIFRoZSBwb3RlbnRpYWxseSBwYXJ0aWFsIG9yIGludmFsaWQgc2V0dGluZ3Mgb2JqZWN0LlxyXG4gICAqIEByZXR1cm5zIEEgY29tcGxldGUgYW5kIHZhbGlkIENoYXRzaWRpYW5TZXR0aW5ncyBvYmplY3QuXHJcbiAgICovXHJcbiAgc3RhdGljIHZhbGlkYXRlKHNldHRpbmdzOiBQYXJ0aWFsPENoYXRzaWRpYW5TZXR0aW5ncz4pOiBDaGF0c2lkaWFuU2V0dGluZ3Mge1xyXG4gICAgY29uc3QgbWVyZ2VkID0geyAuLi5ERUZBVUxUX1NFVFRJTkdTLCAuLi5zZXR0aW5ncyB9O1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIC4uLm1lcmdlZCxcclxuICAgICAgcHJvdmlkZXI6IHRoaXMudmFsaWRhdGVQcm92aWRlcihtZXJnZWQucHJvdmlkZXIpLFxyXG4gICAgICBhcGlLZXk6IG1lcmdlZC5hcGlLZXkgfHwgJycsIC8vIEVuc3VyZSBhcGlLZXkgaXMgYXQgbGVhc3QgYW4gZW1wdHkgc3RyaW5nXHJcbiAgICAgIGFwaUVuZHBvaW50OiBtZXJnZWQuYXBpRW5kcG9pbnQgfHwgJycsIC8vIEVuc3VyZSBhcGlFbmRwb2ludCBpcyBhdCBsZWFzdCBhbiBlbXB0eSBzdHJpbmdcclxuICAgICAgY29udmVyc2F0aW9uc0ZvbGRlcjogdGhpcy52YWxpZGF0ZUZvbGRlclBhdGgobWVyZ2VkLmNvbnZlcnNhdGlvbnNGb2xkZXIpLFxyXG4gICAgICBtYXhNZXNzYWdlczogTWF0aC5tYXgoMTAsIG1lcmdlZC5tYXhNZXNzYWdlcyB8fCBERUZBVUxUX1NFVFRJTkdTLm1heE1lc3NhZ2VzKSwgLy8gRW5zdXJlIGF0IGxlYXN0IDEwXHJcbiAgICAgIGRlZmF1bHRTeXN0ZW1Qcm9tcHQ6IG1lcmdlZC5kZWZhdWx0U3lzdGVtUHJvbXB0ICE9PSB1bmRlZmluZWQgPyBtZXJnZWQuZGVmYXVsdFN5c3RlbVByb21wdCA6IERFRkFVTFRfU0VUVElOR1MuZGVmYXVsdFN5c3RlbVByb21wdCxcclxuICAgICAgdGhlbWU6IHRoaXMudmFsaWRhdGVUaGVtZShtZXJnZWQudGhlbWUpLFxyXG4gICAgICBmb250U2l6ZTogTWF0aC5tYXgoOCwgbWVyZ2VkLmZvbnRTaXplIHx8IERFRkFVTFRfU0VUVElOR1MuZm9udFNpemUpLCAvLyBFbnN1cmUgYXQgbGVhc3QgOHB4XHJcbiAgICAgIHNob3dUaW1lc3RhbXBzOiB0eXBlb2YgbWVyZ2VkLnNob3dUaW1lc3RhbXBzID09PSAnYm9vbGVhbicgPyBtZXJnZWQuc2hvd1RpbWVzdGFtcHMgOiBERUZBVUxUX1NFVFRJTkdTLnNob3dUaW1lc3RhbXBzLFxyXG4gICAgICBkZWJ1Z01vZGU6IHR5cGVvZiBtZXJnZWQuZGVidWdNb2RlID09PSAnYm9vbGVhbicgPyBtZXJnZWQuZGVidWdNb2RlIDogREVGQVVMVF9TRVRUSU5HUy5kZWJ1Z01vZGUsXHJcbiAgICAgIGF1dG9Mb2FkQkNQczogQXJyYXkuaXNBcnJheShtZXJnZWQuYXV0b0xvYWRCQ1BzKSA/IG1lcmdlZC5hdXRvTG9hZEJDUHMgOiBERUZBVUxUX1NFVFRJTkdTLmF1dG9Mb2FkQkNQcyxcclxuICAgICAgZGVmYXVsdFRlbXBlcmF0dXJlOiB0aGlzLnZhbGlkYXRlVGVtcGVyYXR1cmUobWVyZ2VkLmRlZmF1bHRUZW1wZXJhdHVyZSksXHJcbiAgICAgIGRlZmF1bHRNYXhUb2tlbnM6IHRoaXMudmFsaWRhdGVNYXhUb2tlbnMobWVyZ2VkLmRlZmF1bHRNYXhUb2tlbnMpLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlcyB0aGUgcHJvdmlkZXIgc2V0dGluZywgZGVmYXVsdGluZyBpZiBpbnZhbGlkLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIHZhbGlkYXRlUHJvdmlkZXIocHJvdmlkZXI/OiBzdHJpbmcpOiBDaGF0c2lkaWFuU2V0dGluZ3NbJ3Byb3ZpZGVyJ10ge1xyXG4gICAgY29uc3QgdmFsaWRQcm92aWRlcnM6IEFycmF5PENoYXRzaWRpYW5TZXR0aW5nc1sncHJvdmlkZXInXT4gPSBbXHJcbiAgICAgICdhbnRocm9waWMnLFxyXG4gICAgICAnb3BlbmFpJyxcclxuICAgICAgJ29wZW5yb3V0ZXInLFxyXG4gICAgICAnZ29vZ2xlJyxcclxuICAgICAgJ2N1c3RvbScsXHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIHZhbGlkUHJvdmlkZXJzLmluY2x1ZGVzKHByb3ZpZGVyIGFzIGFueSlcclxuICAgICAgPyAocHJvdmlkZXIgYXMgQ2hhdHNpZGlhblNldHRpbmdzWydwcm92aWRlciddKVxyXG4gICAgICA6IERFRkFVTFRfU0VUVElOR1MucHJvdmlkZXI7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWYWxpZGF0ZXMgdGhlIHRoZW1lIHNldHRpbmcsIGRlZmF1bHRpbmcgaWYgaW52YWxpZC5cclxuICAgKi9cclxuICBwcml2YXRlIHN0YXRpYyB2YWxpZGF0ZVRoZW1lKHRoZW1lPzogc3RyaW5nKTogQ2hhdHNpZGlhblNldHRpbmdzWyd0aGVtZSddIHtcclxuICAgICAgY29uc3QgdmFsaWRUaGVtZXM6IEFycmF5PENoYXRzaWRpYW5TZXR0aW5nc1sndGhlbWUnXT4gPSBbJ2xpZ2h0JywgJ2RhcmsnLCAnc3lzdGVtJ107XHJcbiAgICAgIHJldHVybiB2YWxpZFRoZW1lcy5pbmNsdWRlcyh0aGVtZSBhcyBhbnkpXHJcbiAgICAgICAgICA/ICh0aGVtZSBhcyBDaGF0c2lkaWFuU2V0dGluZ3NbJ3RoZW1lJ10pXHJcbiAgICAgICAgICA6IERFRkFVTFRfU0VUVElOR1MudGhlbWU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWYWxpZGF0ZXMgYW5kIG5vcm1hbGl6ZXMgYSBmb2xkZXIgcGF0aCBzdHJpbmcuXHJcbiAgICogUmVtb3ZlcyBsZWFkaW5nL3RyYWlsaW5nIHNsYXNoZXMgYW5kIGVuc3VyZXMgaXQncyBub3QgZW1wdHkuXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgdmFsaWRhdGVGb2xkZXJQYXRoKHBhdGg/OiBzdHJpbmcpOiBzdHJpbmcge1xyXG4gICAgaWYgKCFwYXRoKSByZXR1cm4gREVGQVVMVF9TRVRUSU5HUy5jb252ZXJzYXRpb25zRm9sZGVyO1xyXG5cclxuICAgIC8vIFJlbW92ZSBsZWFkaW5nL3RyYWlsaW5nIHNsYXNoZXMgYW5kIGJhY2tzbGFzaGVzXHJcbiAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9eW1xcXFwvXSt8W1xcXFwvXSskL2csICcnKTtcclxuXHJcbiAgICAvLyBFbnN1cmUgcGF0aCBpcyBub3QgZW1wdHkgYWZ0ZXIgdHJpbW1pbmdcclxuICAgIHJldHVybiBwYXRoIHx8IERFRkFVTFRfU0VUVElOR1MuY29udmVyc2F0aW9uc0ZvbGRlcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlcyB0aGUgdGVtcGVyYXR1cmUgc2V0dGluZywgY2xhbXBpbmcgaXQgYmV0d2VlbiAwIGFuZCAxLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIHZhbGlkYXRlVGVtcGVyYXR1cmUodGVtcGVyYXR1cmU/OiBudW1iZXIpOiBudW1iZXIge1xyXG4gICAgY29uc3QgdGVtcCA9IHRlbXBlcmF0dXJlID8/IERFRkFVTFRfU0VUVElOR1MuZGVmYXVsdFRlbXBlcmF0dXJlO1xyXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHRlbXApKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFZhbGlkYXRlcyB0aGUgbWF4IHRva2VucyBzZXR0aW5nLCBlbnN1cmluZyBpdCdzIGEgcG9zaXRpdmUgaW50ZWdlciB3aXRoaW4gYSByZWFzb25hYmxlIHJhbmdlLlxyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhdGljIHZhbGlkYXRlTWF4VG9rZW5zKG1heFRva2Vucz86IG51bWJlcik6IG51bWJlciB7XHJcbiAgICBjb25zdCB0b2tlbnMgPSBtYXhUb2tlbnMgPz8gREVGQVVMVF9TRVRUSU5HUy5kZWZhdWx0TWF4VG9rZW5zO1xyXG4gICAgLy8gQXNzdW1pbmcgYSBwcmFjdGljYWwgdXBwZXIgbGltaXQsIGUuZy4sIDMyaywgYWRqdXN0IGFzIG5lZWRlZFxyXG4gICAgcmV0dXJuIE1hdGgubWF4KDEsIE1hdGgubWluKDMyMDAwLCBNYXRoLmZsb29yKHRva2VucykpKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBMb2FkcyBzZXR0aW5ncyBmcm9tIE9ic2lkaWFuJ3MgZGF0YSBwZXJzaXN0ZW5jZSwgdmFsaWRhdGVzIHRoZW0sIGFuZCByZXR1cm5zIGEgY29tcGxldGUgc2V0dGluZ3Mgb2JqZWN0LlxyXG4gKiBAcGFyYW0gbG9hZGVkRGF0YSBEYXRhIG9iamVjdCBsb2FkZWQgdmlhIE9ic2lkaWFuJ3MgYGxvYWREYXRhKClgLlxyXG4gKiBAcmV0dXJucyBBIHZhbGlkYXRlZCBDaGF0c2lkaWFuU2V0dGluZ3Mgb2JqZWN0LlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRTZXR0aW5ncyhsb2FkZWREYXRhOiBhbnkpOiBDaGF0c2lkaWFuU2V0dGluZ3Mge1xyXG4gIC8vIFRoZSBsb2FkZWREYXRhIG1pZ2h0IGJlIG51bGwgb3IgdW5kZWZpbmVkIGlmIGl0J3MgdGhlIGZpcnN0IHRpbWVcclxuICByZXR1cm4gU2V0dGluZ3NVdGlscy52YWxpZGF0ZShsb2FkZWREYXRhIHx8IHt9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFByZXBhcmVzIHRoZSBzZXR0aW5ncyBvYmplY3QgZm9yIHNhdmluZyB2aWEgT2JzaWRpYW4ncyBgc2F2ZURhdGEoKWAuXHJcbiAqIEN1cnJlbnRseSwgaXQncyBhbiBpZGVudGl0eSBmdW5jdGlvbiBidXQgY2FuIGJlIHVzZWQgZm9yIHRyYW5zZm9ybWF0aW9ucyBpZiBuZWVkZWQgbGF0ZXIuXHJcbiAqIEBwYXJhbSBzZXR0aW5ncyBUaGUgc2V0dGluZ3Mgb2JqZWN0IHRvIHByZXBhcmUgZm9yIHNhdmluZy5cclxuICogQHJldHVybnMgVGhlIHNldHRpbmdzIG9iamVjdCByZWFkeSB0byBiZSBzYXZlZC5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcmVwYXJlU2V0dGluZ3NGb3JTYXZlKHNldHRpbmdzOiBDaGF0c2lkaWFuU2V0dGluZ3MpOiBhbnkge1xyXG4gIC8vIEV4YW1wbGUgdHJhbnNmb3JtYXRpb24gKGlmIG5lZWRlZCk6IENvbnZlcnQgRGF0ZSBvYmplY3RzIHRvIHRpbWVzdGFtcHNcclxuICAvLyBGb3Igbm93LCBqdXN0IHJldHVybiB0aGUgc2V0dGluZ3MgYXMgaXMsIGFzc3VtaW5nIHRoZXkgYXJlIEpTT04tc2VyaWFsaXphYmxlXHJcbiAgcmV0dXJuIHsgLi4uc2V0dGluZ3MgfTtcclxufVxyXG4iXX0=