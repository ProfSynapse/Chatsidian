import { DEFAULT_SETTINGS, SettingsUtils, loadSettings, prepareSettingsForSave, } from '../../src/models/Settings';
describe('Settings Model & Utils', () => {
    // --- DEFAULT_SETTINGS Tests ---
    test('DEFAULT_SETTINGS should contain all required properties', () => {
        // Check a few key properties to ensure the object structure is correct
        expect(DEFAULT_SETTINGS).toHaveProperty('provider');
        expect(DEFAULT_SETTINGS).toHaveProperty('apiKey');
        expect(DEFAULT_SETTINGS).toHaveProperty('model');
        expect(DEFAULT_SETTINGS).toHaveProperty('conversationsFolder');
        expect(DEFAULT_SETTINGS).toHaveProperty('maxMessages');
        expect(DEFAULT_SETTINGS).toHaveProperty('theme');
        expect(DEFAULT_SETTINGS).toHaveProperty('fontSize');
        expect(DEFAULT_SETTINGS).toHaveProperty('showTimestamps');
        expect(DEFAULT_SETTINGS).toHaveProperty('debugMode');
        expect(DEFAULT_SETTINGS).toHaveProperty('autoLoadBCPs');
        expect(DEFAULT_SETTINGS).toHaveProperty('defaultTemperature');
        expect(DEFAULT_SETTINGS).toHaveProperty('defaultMaxTokens');
        // Ensure no unexpected properties are present (optional check)
        expect(Object.keys(DEFAULT_SETTINGS).length).toBe(13);
    });
    test('DEFAULT_SETTINGS should have sensible default values', () => {
        expect(DEFAULT_SETTINGS.apiKey).toBe('');
        expect(DEFAULT_SETTINGS.provider).toBe('anthropic');
        expect(DEFAULT_SETTINGS.theme).toBe('system');
        expect(DEFAULT_SETTINGS.debugMode).toBe(false);
        expect(DEFAULT_SETTINGS.defaultTemperature).toBe(0.7);
        expect(DEFAULT_SETTINGS.conversationsFolder).toBe('.chatsidian/conversations');
    });
    // --- SettingsUtils.validate Tests ---
    describe('SettingsUtils.validate', () => {
        test('should return default settings if input is empty or null', () => {
            expect(SettingsUtils.validate({})).toEqual(DEFAULT_SETTINGS);
            expect(SettingsUtils.validate(null)).toEqual(DEFAULT_SETTINGS);
            expect(SettingsUtils.validate(undefined)).toEqual(DEFAULT_SETTINGS);
        });
        test('should merge partial settings with defaults', () => {
            const partial = {
                apiKey: 'test-key-123',
                fontSize: 16,
            };
            const validated = SettingsUtils.validate(partial);
            expect(validated.apiKey).toBe('test-key-123');
            expect(validated.fontSize).toBe(16);
            expect(validated.provider).toBe(DEFAULT_SETTINGS.provider); // Check a default value
            expect(validated.model).toBe(DEFAULT_SETTINGS.model); // Check another default
        });
        test('should validate and correct provider', () => {
            expect(SettingsUtils.validate({ provider: 'openai' }).provider).toBe('openai');
            expect(SettingsUtils.validate({ provider: 'invalid-provider' }).provider).toBe(DEFAULT_SETTINGS.provider);
        });
        test('should validate and correct theme', () => {
            expect(SettingsUtils.validate({ theme: 'dark' }).theme).toBe('dark');
            expect(SettingsUtils.validate({ theme: 'invalid-theme' }).theme).toBe(DEFAULT_SETTINGS.theme);
        });
        test('should validate and normalize conversationsFolder path', () => {
            expect(SettingsUtils.validate({ conversationsFolder: 'my/chats/' }).conversationsFolder).toBe('my/chats');
            expect(SettingsUtils.validate({ conversationsFolder: '/leading/slash' }).conversationsFolder).toBe('leading/slash');
            expect(SettingsUtils.validate({ conversationsFolder: 'trailing/slash/' }).conversationsFolder).toBe('trailing/slash');
            expect(SettingsUtils.validate({ conversationsFolder: '//multiple///slashes//' }).conversationsFolder).toBe('multiple///slashes'); // Inner slashes remain
            expect(SettingsUtils.validate({ conversationsFolder: '' }).conversationsFolder).toBe(DEFAULT_SETTINGS.conversationsFolder);
            expect(SettingsUtils.validate({ conversationsFolder: '/' }).conversationsFolder).toBe(DEFAULT_SETTINGS.conversationsFolder); // Path becomes empty after trim
            expect(SettingsUtils.validate({ conversationsFolder: 'back\\slashes\\' }).conversationsFolder).toBe('back\\slashes');
        });
        test('should validate and clamp temperature', () => {
            expect(SettingsUtils.validate({ defaultTemperature: -0.5 }).defaultTemperature).toBe(0);
            expect(SettingsUtils.validate({ defaultTemperature: 1.5 }).defaultTemperature).toBe(1);
            expect(SettingsUtils.validate({ defaultTemperature: 0.5 }).defaultTemperature).toBe(0.5);
            expect(SettingsUtils.validate({ defaultTemperature: undefined }).defaultTemperature).toBe(DEFAULT_SETTINGS.defaultTemperature);
        });
        test('should validate and clamp maxTokens', () => {
            expect(SettingsUtils.validate({ defaultMaxTokens: 0 }).defaultMaxTokens).toBe(1);
            expect(SettingsUtils.validate({ defaultMaxTokens: -100 }).defaultMaxTokens).toBe(1);
            expect(SettingsUtils.validate({ defaultMaxTokens: 50000 }).defaultMaxTokens).toBe(32000); // Clamp to max practical limit
            expect(SettingsUtils.validate({ defaultMaxTokens: 2048 }).defaultMaxTokens).toBe(2048);
            expect(SettingsUtils.validate({ defaultMaxTokens: undefined }).defaultMaxTokens).toBe(DEFAULT_SETTINGS.defaultMaxTokens);
            expect(SettingsUtils.validate({ defaultMaxTokens: 4000.5 }).defaultMaxTokens).toBe(4000); // Should floor
        });
        test('should validate numeric properties', () => {
            expect(SettingsUtils.validate({ fontSize: 6 }).fontSize).toBe(8); // Clamp min
            expect(SettingsUtils.validate({ fontSize: 15 }).fontSize).toBe(15);
            expect(SettingsUtils.validate({ maxMessages: 5 }).maxMessages).toBe(10); // Clamp min
            expect(SettingsUtils.validate({ maxMessages: 200 }).maxMessages).toBe(200);
        });
        test('should validate boolean properties', () => {
            expect(SettingsUtils.validate({ showTimestamps: false }).showTimestamps).toBe(false);
            expect(SettingsUtils.validate({ showTimestamps: true }).showTimestamps).toBe(true);
            expect(SettingsUtils.validate({ showTimestamps: undefined }).showTimestamps).toBe(DEFAULT_SETTINGS.showTimestamps);
            expect(SettingsUtils.validate({ debugMode: true }).debugMode).toBe(true);
            expect(SettingsUtils.validate({ debugMode: false }).debugMode).toBe(false);
            expect(SettingsUtils.validate({ debugMode: undefined }).debugMode).toBe(DEFAULT_SETTINGS.debugMode);
        });
        test('should validate array properties', () => {
            expect(SettingsUtils.validate({ autoLoadBCPs: ['CustomBCP'] }).autoLoadBCPs).toEqual(['CustomBCP']);
            expect(SettingsUtils.validate({ autoLoadBCPs: undefined }).autoLoadBCPs).toEqual(DEFAULT_SETTINGS.autoLoadBCPs);
            expect(SettingsUtils.validate({ autoLoadBCPs: 'not-an-array' }).autoLoadBCPs).toEqual(DEFAULT_SETTINGS.autoLoadBCPs);
        });
        test('should handle empty strings correctly', () => {
            const settings = SettingsUtils.validate({ apiKey: '' });
            expect(settings.apiKey).toBe('');
            expect(settings.apiEndpoint).toBe('');
        });
    });
    // --- loadSettings Tests ---
    describe('loadSettings', () => {
        test('should call validate with the loaded data', () => {
            const mockData = { apiKey: 'loaded-key', provider: 'openai' };
            const validateSpy = jest.spyOn(SettingsUtils, 'validate');
            loadSettings(mockData);
            expect(validateSpy).toHaveBeenCalledWith(mockData);
            validateSpy.mockRestore();
        });
        test('should call validate with empty object if loaded data is null/undefined', () => {
            const validateSpy = jest.spyOn(SettingsUtils, 'validate');
            loadSettings(null);
            expect(validateSpy).toHaveBeenCalledWith({});
            loadSettings(undefined);
            expect(validateSpy).toHaveBeenCalledWith({});
            validateSpy.mockRestore();
        });
        test('should return validated settings', () => {
            const mockData = { apiKey: 'loaded-key', defaultTemperature: 1.5 }; // Invalid temp
            const settings = loadSettings(mockData);
            expect(settings.apiKey).toBe('loaded-key');
            expect(settings.defaultTemperature).toBe(1); // Check validation occurred
            expect(settings.provider).toBe(DEFAULT_SETTINGS.provider); // Check default merge
        });
    });
    // --- prepareSettingsForSave Tests ---
    describe('prepareSettingsForSave', () => {
        test('should return a copy of the settings object', () => {
            const settings = { ...DEFAULT_SETTINGS, apiKey: 'save-key' };
            const prepared = prepareSettingsForSave(settings);
            expect(prepared).toEqual(settings);
            expect(prepared).not.toBe(settings); // Ensure it's a copy
        });
        // Add more tests here if prepareSettingsForSave ever includes transformations
        // test('should perform necessary transformations before saving', () => {
        //   // Example: const settings = { ...DEFAULT_SETTINGS, someDate: new Date() };
        //   // const prepared = prepareSettingsForSave(settings);
        //   // expect(typeof prepared.someDate).toBe('number'); // Assuming conversion to timestamp
        // });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2V0dGluZ3MudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlNldHRpbmdzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLGdCQUFnQixFQUNoQixhQUFhLEVBQ2IsWUFBWSxFQUNaLHNCQUFzQixHQUN2QixNQUFNLDJCQUEyQixDQUFDO0FBRW5DLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDdEMsaUNBQWlDO0lBRWpDLElBQUksQ0FBQyx5REFBeUQsRUFBRSxHQUFHLEVBQUU7UUFDbkUsdUVBQXVFO1FBQ3ZFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQy9ELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUN2RCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxjQUFjLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUMvRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDakQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyRCxNQUFNLENBQUMsZ0JBQWdCLENB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MUQsNEZBQTRGO1FBQzVGLE1BQU07SUFDUixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBDaGF0c2lkaWFuU2V0dGluZ3MsXHJcbiAgREVGQVVMVF9TRVRUSU5HUyxcclxuICBTZXR0aW5nc1V0aWxzLFxyXG4gIGxvYWRTZXR0aW5ncyxcclxuICBwcmVwYXJlU2V0dGluZ3NGb3JTYXZlLFxyXG59IGZyb20gJy4uLy4uL3NyYy9tb2RlbHMvU2V0dGluZ3MnO1xyXG5cclxuZGVzY3JpYmUoJ1NldHRpbmdzIE1vZGVsICYgVXRpbHMnLCAoKSA9PiB7XHJcbiAgLy8gLS0tIERFRkFVTFRfU0VUVElOR1MgVGVzdHMgLS0tXHJcblxyXG4gIHRlc3QoJ0RFRkFVTFRfU0VUVElOR1Mgc2hvdWxkIGNvbnRhaW4gYWxsIHJlcXVpcmVkIHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAvLyBDaGVjayBhIGZldyBrZXkgcHJvcGVydGllcyB0byBlbnN1cmUgdGhlIG9iamVjdCBzdHJ1Y3R1cmUgaXMgY29ycmVjdFxyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MpLnRvSGF2ZVByb3BlcnR5KCdwcm92aWRlcicpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MpLnRvSGF2ZVByb3BlcnR5KCdhcGlLZXknKTtcclxuICAgIGV4cGVjdChERUZBVUxUX1NFVFRJTkdTKS50b0hhdmVQcm9wZXJ0eSgnbW9kZWwnKTtcclxuICAgIGV4cGVjdChERUZBVUxUX1NFVFRJTkdTKS50b0hhdmVQcm9wZXJ0eSgnY29udmVyc2F0aW9uc0ZvbGRlcicpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MpLnRvSGF2ZVByb3BlcnR5KCdtYXhNZXNzYWdlcycpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MpLnRvSGF2ZVByb3BlcnR5KCdkZWZhdWx0U3lzdGVtUHJvbXB0Jyk7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUykudG9IYXZlUHJvcGVydHkoJ3RoZW1lJyk7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUykudG9IYXZlUHJvcGVydHkoJ2ZvbnRTaXplJyk7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUykudG9IYXZlUHJvcGVydHkoJ3Nob3dUaW1lc3RhbXBzJyk7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUykudG9IYXZlUHJvcGVydHkoJ2RlYnVnTW9kZScpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MpLnRvSGF2ZVByb3BlcnR5KCdhdXRvTG9hZEJDUHMnKTtcclxuICAgIGV4cGVjdChERUZBVUxUX1NFVFRJTkdTKS50b0hhdmVQcm9wZXJ0eSgnZGVmYXVsdFRlbXBlcmF0dXJlJyk7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUykudG9IYXZlUHJvcGVydHkoJ2RlZmF1bHRNYXhUb2tlbnMnKTtcclxuICAgIC8vIEVuc3VyZSBubyB1bmV4cGVjdGVkIHByb3BlcnRpZXMgYXJlIHByZXNlbnQgKG9wdGlvbmFsIGNoZWNrKVxyXG4gICAgZXhwZWN0KE9iamVjdC5rZXlzKERFRkFVTFRfU0VUVElOR1MpLmxlbmd0aCkudG9CZSgxNCk7XHJcbiAgfSk7XHJcblxyXG4gIHRlc3QoJ0RFRkFVTFRfU0VUVElOR1Mgc2hvdWxkIGhhdmUgc2Vuc2libGUgZGVmYXVsdCB2YWx1ZXMnLCAoKSA9PiB7XHJcbiAgICBleHBlY3QoREVGQVVMVF9TRVRUSU5HUy5hcGlLZXkpLnRvQmUoJycpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MucHJvdmlkZXIpLnRvQmUoJ2FudGhyb3BpYycpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MudGhlbWUpLnRvQmUoJ3N5c3RlbScpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MuZGVidWdNb2RlKS50b0JlKGZhbHNlKTtcclxuICAgIGV4cGVjdChERUZBVUxUX1NFVFRJTkdTLmRlZmF1bHRUZW1wZXJhdHVyZSkudG9CZSgwLjcpO1xyXG4gICAgZXhwZWN0KERFRkFVTFRfU0VUVElOR1MuY29udmVyc2F0aW9uc0ZvbGRlcikudG9CZSgnLmNoYXRzaWRpYW4vY29udmVyc2F0aW9ucycpO1xyXG4gIH0pO1xyXG5cclxuICAvLyAtLS0gU2V0dGluZ3NVdGlscy52YWxpZGF0ZSBUZXN0cyAtLS1cclxuXHJcbiAgZGVzY3JpYmUoJ1NldHRpbmdzVXRpbHMudmFsaWRhdGUnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGRlZmF1bHQgc2V0dGluZ3MgaWYgaW5wdXQgaXMgZW1wdHkgb3IgbnVsbCcsICgpID0+IHtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoe30pKS50b0VxdWFsKERFRkFVTFRfU0VUVElOR1MpO1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZShudWxsIGFzIGFueSkpLnRvRXF1YWwoREVGQVVMVF9TRVRUSU5HUyk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHVuZGVmaW5lZCBhcyBhbnkpKS50b0VxdWFsKERFRkFVTFRfU0VUVElOR1MpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIG1lcmdlIHBhcnRpYWwgc2V0dGluZ3Mgd2l0aCBkZWZhdWx0cycsICgpID0+IHtcclxuICAgICAgY29uc3QgcGFydGlhbDogUGFydGlhbDxDaGF0c2lkaWFuU2V0dGluZ3M+ID0ge1xyXG4gICAgICAgIGFwaUtleTogJ3Rlc3Qta2V5LTEyMycsXHJcbiAgICAgICAgZm9udFNpemU6IDE2LFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCB2YWxpZGF0ZWQgPSBTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHBhcnRpYWwpO1xyXG4gICAgICBleHBlY3QodmFsaWRhdGVkLmFwaUtleSkudG9CZSgndGVzdC1rZXktMTIzJyk7XHJcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZWQuZm9udFNpemUpLnRvQmUoMTYpO1xyXG4gICAgICBleHBlY3QodmFsaWRhdGVkLnByb3ZpZGVyKS50b0JlKERFRkFVTFRfU0VUVElOR1MucHJvdmlkZXIpOyAvLyBDaGVjayBhIGRlZmF1bHQgdmFsdWVcclxuICAgICAgZXhwZWN0KHZhbGlkYXRlZC5tb2RlbCkudG9CZShERUZBVUxUX1NFVFRJTkdTLm1vZGVsKTsgLy8gQ2hlY2sgYW5vdGhlciBkZWZhdWx0XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgYW5kIGNvcnJlY3QgcHJvdmlkZXInLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgcHJvdmlkZXI6ICdvcGVuYWknIH0pLnByb3ZpZGVyKS50b0JlKCdvcGVuYWknKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBwcm92aWRlcjogJ2ludmFsaWQtcHJvdmlkZXInIGFzIGFueSB9KS5wcm92aWRlcikudG9CZShERUZBVUxUX1NFVFRJTkdTLnByb3ZpZGVyKTtcclxuICAgIH0pO1xyXG5cclxuICAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgYW5kIGNvcnJlY3QgdGhlbWUnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgdGhlbWU6ICdkYXJrJyB9KS50aGVtZSkudG9CZSgnZGFyaycpO1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IHRoZW1lOiAnaW52YWxpZC10aGVtZScgYXMgYW55IH0pLnRoZW1lKS50b0JlKERFRkFVTFRfU0VUVElOR1MudGhlbWUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIGFuZCBub3JtYWxpemUgY29udmVyc2F0aW9uc0ZvbGRlciBwYXRoJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGNvbnZlcnNhdGlvbnNGb2xkZXI6ICdteS9jaGF0cy8nIH0pLmNvbnZlcnNhdGlvbnNGb2xkZXIpLnRvQmUoJ215L2NoYXRzJyk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgY29udmVyc2F0aW9uc0ZvbGRlcjogJy9sZWFkaW5nL3NsYXNoJyB9KS5jb252ZXJzYXRpb25zRm9sZGVyKS50b0JlKCdsZWFkaW5nL3NsYXNoJyk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgY29udmVyc2F0aW9uc0ZvbGRlcjogJ3RyYWlsaW5nL3NsYXNoLycgfSkuY29udmVyc2F0aW9uc0ZvbGRlcikudG9CZSgndHJhaWxpbmcvc2xhc2gnKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBjb252ZXJzYXRpb25zRm9sZGVyOiAnLy9tdWx0aXBsZS8vL3NsYXNoZXMvLycgfSkuY29udmVyc2F0aW9uc0ZvbGRlcikudG9CZSgnbXVsdGlwbGUvLy9zbGFzaGVzJyk7IC8vIElubmVyIHNsYXNoZXMgcmVtYWluXHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgY29udmVyc2F0aW9uc0ZvbGRlcjogJycgfSkuY29udmVyc2F0aW9uc0ZvbGRlcikudG9CZShERUZBVUxUX1NFVFRJTkdTLmNvbnZlcnNhdGlvbnNGb2xkZXIpO1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGNvbnZlcnNhdGlvbnNGb2xkZXI6ICcvJyB9KS5jb252ZXJzYXRpb25zRm9sZGVyKS50b0JlKERFRkFVTFRfU0VUVElOR1MuY29udmVyc2F0aW9uc0ZvbGRlcik7IC8vIFBhdGggYmVjb21lcyBlbXB0eSBhZnRlciB0cmltXHJcbiAgICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGNvbnZlcnNhdGlvbnNGb2xkZXI6ICdiYWNrXFxcXHNsYXNoZXNcXFxcJyB9KS5jb252ZXJzYXRpb25zRm9sZGVyKS50b0JlKCdiYWNrXFxcXHNsYXNoZXMnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgY2xhbXAgdGVtcGVyYXR1cmUnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdFRlbXBlcmF0dXJlOiAtMC41IH0pLmRlZmF1bHRUZW1wZXJhdHVyZSkudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBkZWZhdWx0VGVtcGVyYXR1cmU6IDEuNSB9KS5kZWZhdWx0VGVtcGVyYXR1cmUpLnRvQmUoMSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdFRlbXBlcmF0dXJlOiAwLjUgfSkuZGVmYXVsdFRlbXBlcmF0dXJlKS50b0JlKDAuNSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdFRlbXBlcmF0dXJlOiB1bmRlZmluZWQgfSkuZGVmYXVsdFRlbXBlcmF0dXJlKS50b0JlKERFRkFVTFRfU0VUVElOR1MuZGVmYXVsdFRlbXBlcmF0dXJlKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBhbmQgY2xhbXAgbWF4VG9rZW5zJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGRlZmF1bHRNYXhUb2tlbnM6IDAgfSkuZGVmYXVsdE1heFRva2VucykudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBkZWZhdWx0TWF4VG9rZW5zOiAtMTAwIH0pLmRlZmF1bHRNYXhUb2tlbnMpLnRvQmUoMSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdE1heFRva2VuczogNTAwMDAgfSkuZGVmYXVsdE1heFRva2VucykudG9CZSgzMjAwMCk7IC8vIENsYW1wIHRvIG1heCBwcmFjdGljYWwgbGltaXRcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBkZWZhdWx0TWF4VG9rZW5zOiAyMDQ4IH0pLmRlZmF1bHRNYXhUb2tlbnMpLnRvQmUoMjA0OCk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdE1heFRva2VuczogdW5kZWZpbmVkIH0pLmRlZmF1bHRNYXhUb2tlbnMpLnRvQmUoREVGQVVMVF9TRVRUSU5HUy5kZWZhdWx0TWF4VG9rZW5zKTtcclxuICAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZGVmYXVsdE1heFRva2VuczogNDAwMC41IH0pLmRlZmF1bHRNYXhUb2tlbnMpLnRvQmUoNDAwMCk7IC8vIFNob3VsZCBmbG9vclxyXG4gICAgfSk7XHJcblxyXG4gICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBudW1lcmljIHByb3BlcnRpZXMnLCAoKSA9PiB7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgZm9udFNpemU6IDYgfSkuZm9udFNpemUpLnRvQmUoOCk7IC8vIENsYW1wIG1pblxyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGZvbnRTaXplOiAxNSB9KS5mb250U2l6ZSkudG9CZSgxNSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgbWF4TWVzc2FnZXM6IDUgfSkubWF4TWVzc2FnZXMpLnRvQmUoMTApOyAvLyBDbGFtcCBtaW5cclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBtYXhNZXNzYWdlczogMjAwIH0pLm1heE1lc3NhZ2VzKS50b0JlKDIwMCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgYm9vbGVhbiBwcm9wZXJ0aWVzJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IHNob3dUaW1lc3RhbXBzOiBmYWxzZSB9KS5zaG93VGltZXN0YW1wcykudG9CZShmYWxzZSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgc2hvd1RpbWVzdGFtcHM6IHRydWUgfSkuc2hvd1RpbWVzdGFtcHMpLnRvQmUodHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgc2hvd1RpbWVzdGFtcHM6IHVuZGVmaW5lZCB9KS5zaG93VGltZXN0YW1wcykudG9CZShERUZBVUxUX1NFVFRJTkdTLnNob3dUaW1lc3RhbXBzKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBkZWJ1Z01vZGU6IHRydWUgfSkuZGVidWdNb2RlKS50b0JlKHRydWUpO1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGRlYnVnTW9kZTogZmFsc2UgfSkuZGVidWdNb2RlKS50b0JlKGZhbHNlKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBkZWJ1Z01vZGU6IHVuZGVmaW5lZCB9KS5kZWJ1Z01vZGUpLnRvQmUoREVGQVVMVF9TRVRUSU5HUy5kZWJ1Z01vZGUpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBhcnJheSBwcm9wZXJ0aWVzJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QoU2V0dGluZ3NVdGlscy52YWxpZGF0ZSh7IGF1dG9Mb2FkQkNQczogWydDdXN0b21CQ1AnXSB9KS5hdXRvTG9hZEJDUHMpLnRvRXF1YWwoWydDdXN0b21CQ1AnXSk7XHJcbiAgICAgIGV4cGVjdChTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgYXV0b0xvYWRCQ1BzOiB1bmRlZmluZWQgfSkuYXV0b0xvYWRCQ1BzKS50b0VxdWFsKERFRkFVTFRfU0VUVElOR1MuYXV0b0xvYWRCQ1BzKTtcclxuICAgICAgZXhwZWN0KFNldHRpbmdzVXRpbHMudmFsaWRhdGUoeyBhdXRvTG9hZEJDUHM6ICdub3QtYW4tYXJyYXknIGFzIGFueSB9KS5hdXRvTG9hZEJDUHMpLnRvRXF1YWwoREVGQVVMVF9TRVRUSU5HUy5hdXRvTG9hZEJDUHMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgc3RyaW5ncyBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBTZXR0aW5nc1V0aWxzLnZhbGlkYXRlKHsgYXBpS2V5OiAnJywgZGVmYXVsdFN5c3RlbVByb21wdDogJycgfSk7XHJcbiAgICAgICAgZXhwZWN0KHNldHRpbmdzLmFwaUtleSkudG9CZSgnJyk7XHJcbiAgICAgICAgZXhwZWN0KHNldHRpbmdzLmRlZmF1bHRTeXN0ZW1Qcm9tcHQpLnRvQmUoJycpOyAvLyBTaG91bGQgYWxsb3cgZW1wdHkgc3lzdGVtIHByb21wdFxyXG4gICAgICAgIGV4cGVjdChzZXR0aW5ncy5hcGlFbmRwb2ludCkudG9CZSgnJyk7XHJcbiAgICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIC0tLSBsb2FkU2V0dGluZ3MgVGVzdHMgLS0tXHJcblxyXG4gIGRlc2NyaWJlKCdsb2FkU2V0dGluZ3MnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgY2FsbCB2YWxpZGF0ZSB3aXRoIHRoZSBsb2FkZWQgZGF0YScsICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja0RhdGEgPSB7IGFwaUtleTogJ2xvYWRlZC1rZXknLCBwcm92aWRlcjogJ29wZW5haScgfTtcclxuICAgICAgY29uc3QgdmFsaWRhdGVTcHkgPSBqZXN0LnNweU9uKFNldHRpbmdzVXRpbHMsICd2YWxpZGF0ZScpO1xyXG4gICAgICBsb2FkU2V0dGluZ3MobW9ja0RhdGEpO1xyXG4gICAgICBleHBlY3QodmFsaWRhdGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vY2tEYXRhKTtcclxuICAgICAgdmFsaWRhdGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBjYWxsIHZhbGlkYXRlIHdpdGggZW1wdHkgb2JqZWN0IGlmIGxvYWRlZCBkYXRhIGlzIG51bGwvdW5kZWZpbmVkJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB2YWxpZGF0ZVNweSA9IGplc3Quc3B5T24oU2V0dGluZ3NVdGlscywgJ3ZhbGlkYXRlJyk7XHJcbiAgICAgIGxvYWRTZXR0aW5ncyhudWxsKTtcclxuICAgICAgZXhwZWN0KHZhbGlkYXRlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7fSk7XHJcbiAgICAgIGxvYWRTZXR0aW5ncyh1bmRlZmluZWQpO1xyXG4gICAgICBleHBlY3QodmFsaWRhdGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHt9KTtcclxuICAgICAgdmFsaWRhdGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gdmFsaWRhdGVkIHNldHRpbmdzJywgKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vY2tEYXRhID0geyBhcGlLZXk6ICdsb2FkZWQta2V5JywgZGVmYXVsdFRlbXBlcmF0dXJlOiAxLjUgfTsgLy8gSW52YWxpZCB0ZW1wXHJcbiAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBsb2FkU2V0dGluZ3MobW9ja0RhdGEpO1xyXG4gICAgICAgIGV4cGVjdChzZXR0aW5ncy5hcGlLZXkpLnRvQmUoJ2xvYWRlZC1rZXknKTtcclxuICAgICAgICBleHBlY3Qoc2V0dGluZ3MuZGVmYXVsdFRlbXBlcmF0dXJlKS50b0JlKDEpOyAvLyBDaGVjayB2YWxpZGF0aW9uIG9jY3VycmVkXHJcbiAgICAgICAgZXhwZWN0KHNldHRpbmdzLnByb3ZpZGVyKS50b0JlKERFRkFVTFRfU0VUVElOR1MucHJvdmlkZXIpOyAvLyBDaGVjayBkZWZhdWx0IG1lcmdlXHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgLy8gLS0tIHByZXBhcmVTZXR0aW5nc0ZvclNhdmUgVGVzdHMgLS0tXHJcblxyXG4gIGRlc2NyaWJlKCdwcmVwYXJlU2V0dGluZ3NGb3JTYXZlJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIHJldHVybiBhIGNvcHkgb2YgdGhlIHNldHRpbmdzIG9iamVjdCcsICgpID0+IHtcclxuICAgICAgY29uc3Qgc2V0dGluZ3M6IENoYXRzaWRpYW5TZXR0aW5ncyA9IHsgLi4uREVGQVVMVF9TRVRUSU5HUywgYXBpS2V5OiAnc2F2ZS1rZXknIH07XHJcbiAgICAgIGNvbnN0IHByZXBhcmVkID0gcHJlcGFyZVNldHRpbmdzRm9yU2F2ZShzZXR0aW5ncyk7XHJcbiAgICAgIGV4cGVjdChwcmVwYXJlZCkudG9FcXVhbChzZXR0aW5ncyk7XHJcbiAgICAgIGV4cGVjdChwcmVwYXJlZCkubm90LnRvQmUoc2V0dGluZ3MpOyAvLyBFbnN1cmUgaXQncyBhIGNvcHlcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEFkZCBtb3JlIHRlc3RzIGhlcmUgaWYgcHJlcGFyZVNldHRpbmdzRm9yU2F2ZSBldmVyIGluY2x1ZGVzIHRyYW5zZm9ybWF0aW9uc1xyXG4gICAgLy8gdGVzdCgnc2hvdWxkIHBlcmZvcm0gbmVjZXNzYXJ5IHRyYW5zZm9ybWF0aW9ucyBiZWZvcmUgc2F2aW5nJywgKCkgPT4ge1xyXG4gICAgLy8gICAvLyBFeGFtcGxlOiBjb25zdCBzZXR0aW5ncyA9IHsgLi4uREVGQVVMVF9TRVRUSU5HUywgc29tZURhdGU6IG5ldyBEYXRlKCkgfTtcclxuICAgIC8vICAgLy8gY29uc3QgcHJlcGFyZWQgPSBwcmVwYXJlU2V0dGluZ3NGb3JTYXZlKHNldHRpbmdzKTtcclxuICAgIC8vICAgLy8gZXhwZWN0KHR5cGVvZiBwcmVwYXJlZC5zb21lRGF0ZSkudG9CZSgnbnVtYmVyJyk7IC8vIEFzc3VtaW5nIGNvbnZlcnNpb24gdG8gdGltZXN0YW1wXHJcbiAgICAvLyB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==